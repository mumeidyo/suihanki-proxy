/**
 * Android特化型プレーヤーHTMLテンプレート
 * - MediaSession APIによる通知コントロール
 * - WakeLock APIの使用
 * - サイレントオーディオによるスリープ防止
 * - ネイティブハンドラーへのフォールバック
 * - 複数のスリープ防止技術を組み合わせた強化版
 */
export function getAndroidPlayerHtml(
  videoId: string, 
  title: string, 
  thumbnailUrl: string,
  channelTitle: string
): string {
  return `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <title>${title}</title>
  <link rel="icon" href="${thumbnailUrl}" type="image/jpeg">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { 
      height: 100%; 
      width: 100%; 
      background: #000; 
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      overflow: hidden;
      touch-action: manipulation;
    }
    .player-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      z-index: 1;
    }
    .video-wrapper {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 アスペクト比 */
      background: #000;
      flex-grow: 1;
    }
    video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #000;
    }
    .controls {
      position: relative;
      width: 100%;
      padding: 15px;
      background: rgba(0,0,0,0.7);
      z-index: 2;
    }
    .info {
      padding: 10px 15px;
      background: rgba(0,0,0,0.7);
    }
    h1 {
      font-size: 18px;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .channel {
      font-size: 14px;
      color: #aaa;
      margin-bottom: 10px;
    }
    .button-container {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 10px;
    }
    button {
      flex: 1;
      background: #333;
      border: none;
      color: white;
      padding: 10px;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover, button:active {
      background: #555;
    }
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
      padding: 20px;
      text-align: center;
    }
    .overlay p {
      margin-bottom: 20px;
      font-size: 16px;
    }
    .hidden { display: none; }
    .status {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: #0f0;
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 10px;
      z-index: 100;
    }
    .badge {
      display: inline-block;
      background: #f00;
      color: #fff;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 12px;
      margin-left: 5px;
    }
    .progress-container {
      width: 100%;
      height: 5px;
      background: #333;
      margin-bottom: 10px;
      border-radius: 5px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: #f00;
      width: 0%;
      transition: width 0.5s;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    .pulse {
      animation: pulse 2s infinite;
    }
    #silent-audio { 
      display: none;
    }
    #secondary-video {
      position: absolute;
      width: 1px;
      height: 1px;
      left: 0;
      top: 0;
      opacity: 0.01;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <!-- メインビデオコンテナ -->
  <div class="player-container">
    <div class="info">
      <h1>${title}</h1>
      <div class="channel">${channelTitle}</div>
    </div>
    
    <div class="video-wrapper">
      <video id="video-player" controls playsinline autoplay></video>
      <!-- バックグラウンド動作継続用のサイレントビデオ要素 -->
      <video id="secondary-video" loop muted playsinline autoplay></video>
    </div>
    
    <div class="controls">
      <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <div class="button-container">
        <button id="restart-button">再起動</button>
        <button id="direct-button">直接再生</button>
        <button id="youtube-button">YouTubeで開く</button>
      </div>
    </div>
  </div>
  
  <!-- スリープ防止のためのサイレントオーディオ -->
  <audio id="silent-audio" loop autoplay muted></audio>
  
  <!-- ステータス表示 -->
  <div id="status" class="status">準備中...</div>
  
  <!-- 問題発生時のオーバーレイ -->
  <div id="error-overlay" class="overlay hidden">
    <p>再生中に問題が発生しました。<br>以下のオプションから選択してください。</p>
    <div class="button-container">
      <button id="retry-button">再試行</button>
      <button id="alt-button">別の方法で再生</button>
      <button id="open-youtube">YouTubeで開く</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 各種要素参照
      const videoPlayer = document.getElementById('video-player');
      const secondaryVideo = document.getElementById('secondary-video');
      const statusElement = document.getElementById('status');
      const progressBar = document.getElementById('progress-bar');
      const errorOverlay = document.getElementById('error-overlay');
      const silentAudio = document.getElementById('silent-audio');
      
      // ボタン参照
      const restartButton = document.getElementById('restart-button');
      const directButton = document.getElementById('direct-button');
      const youtubeButton = document.getElementById('youtube-button');
      const retryButton = document.getElementById('retry-button');
      const altButton = document.getElementById('alt-button');
      const openYoutubeButton = document.getElementById('open-youtube');
      
      // 動画情報
      const videoId = '${videoId}';
      const videoTitle = '${title}';
      const thumbnailUrl = '${thumbnailUrl}';
      const channelTitle = '${channelTitle}';
      
      // 状態変数
      let wakeLock = null;
      let mediaSession = null;
      let isSleeping = false;
      let lastActivityTime = Date.now();
      let playbackStarted = false;
      let errorCount = 0;
      let videoCheckInterval = null;
      let cpuTaskInterval = null;
      
      // URLパラメータからモードを取得
      const urlParams = new URLSearchParams(window.location.search);
      const mode = urlParams.get('mode') || 'hybrid';
      
      // ステータス更新関数
      function updateStatus(message, isError = false) {
        statusElement.textContent = message;
        statusElement.style.color = isError ? '#f55' : '#0f0';
        console.log('[Player]', message);
      }

      // 進捗バー更新
      function updateProgressBar() {
        if (videoPlayer.duration) {
          const progress = (videoPlayer.currentTime / videoPlayer.duration) * 100;
          progressBar.style.width = progress + '%';
        }
      }
      
      // MediaSession APIの初期化
      function setupMediaSession() {
        if ('mediaSession' in navigator) {
          navigator.mediaSession.metadata = new MediaMetadata({
            title: videoTitle,
            artist: channelTitle,
            album: 'TabTube Player',
            artwork: [
              { src: thumbnailUrl, sizes: '96x96', type: 'image/jpeg' },
              { src: thumbnailUrl, sizes: '128x128', type: 'image/jpeg' },
              { src: thumbnailUrl, sizes: '192x192', type: 'image/jpeg' },
              { src: thumbnailUrl, sizes: '256x256', type: 'image/jpeg' },
              { src: thumbnailUrl, sizes: '384x384', type: 'image/jpeg' },
              { src: thumbnailUrl, sizes: '512x512', type: 'image/jpeg' },
            ]
          });

          navigator.mediaSession.setActionHandler('play', () => {
            videoPlayer.play();
            updateStatus('再生再開');
          });
          
          navigator.mediaSession.setActionHandler('pause', () => {
            videoPlayer.pause();
            updateStatus('一時停止');
          });
          
          navigator.mediaSession.setActionHandler('seekbackward', () => {
            videoPlayer.currentTime = Math.max(videoPlayer.currentTime - 10, 0);
            updateStatus('10秒巻き戻し');
          });
          
          navigator.mediaSession.setActionHandler('seekforward', () => {
            videoPlayer.currentTime = Math.min(videoPlayer.currentTime + 30, videoPlayer.duration);
            updateStatus('30秒進む');
          });
          
          updateStatus('通知コントロール設定完了');
        } else {
          updateStatus('通知コントロール非対応', true);
        }
      }
      
      // WakeLockの取得
      async function acquireWakeLock() {
        if ('wakeLock' in navigator) {
          try {
            wakeLock = await navigator.wakeLock.request('screen');
            wakeLock.addEventListener('release', () => {
              updateStatus('WakeLock解除 - 再取得試行中');
              setTimeout(acquireWakeLock, 1000);
            });
            updateStatus('WakeLock取得成功');
            return true;
          } catch (err) {
            updateStatus('WakeLock取得失敗: ' + err.message, true);
            return false;
          }
        } else {
          updateStatus('WakeLock API非対応', true);
          return false;
        }
      }
      
      // サイレントオーディオの初期化
      function initSilentAudio() {
        // Base64エンコードされた空の音声データ（1秒の無音）
        const silentAudioBase64 = 'data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//uQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAABAAADQgD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8AAAA5TEFNRTMuMTAwAZYAAAAAAAAAABRAJAjYjgAAQAAADUIpyODzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQZAAP8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAETEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==';
        silentAudio.src = silentAudioBase64;
        silentAudio.muted = false;
        silentAudio.volume = 0.01; // 非常に小さいボリューム
        silentAudio.play().catch(err => {
          updateStatus('サイレントオーディオ再生失敗: ' + err.message, true);
        });
      }
      
      // バックグラウンド動作維持のためのCPUタスク
      function startCpuTask() {
        if (cpuTaskInterval) clearInterval(cpuTaskInterval);
        
        cpuTaskInterval = setInterval(() => {
          // CPU使用を維持するための単純な計算
          let counter = 0;
          for (let i = 0; i < 1000000; i++) {
            counter += Math.sqrt(i);
          }
          
          // 定期的に無音データを再生して音声ストリームを維持
          const now = Date.now();
          if (now - lastActivityTime > 10000) { // 10秒ごと
            navigator.vibrate(1); // 極小の振動（感じない程度）
            lastActivityTime = now;
            
            // ビデオの再生状態を確認
            if (videoPlayer.paused && !videoPlayer.ended && playbackStarted) {
              updateStatus('自動再生復帰を試行中...');
              videoPlayer.play().catch(err => {
                updateStatus('再生復帰に失敗: ' + err.message, true);
              });
            }
          }
        }, 5000);
      }
      
      // 再生エラー発生時
      function handlePlaybackError(error) {
        errorCount++;
        updateStatus('再生エラー: ' + (error.message || 'Unknown'), true);
        
        if (errorCount > 3) {
          // 3回以上エラーが発生した場合はオーバーレイを表示
          errorOverlay.classList.remove('hidden');
        } else {
          // リトライ
          setTimeout(() => {
            loadDirectVideo();
          }, 3000);
        }
      }
      
      // 再生状態の監視
      function startVideoMonitoring() {
        if (videoCheckInterval) clearInterval(videoCheckInterval);
        
        let lastPosition = -1;
        let stuckCounter = 0;
        
        videoCheckInterval = setInterval(() => {
          if (!videoPlayer.paused && playbackStarted) {
            // 再生位置が更新されているか確認
            if (videoPlayer.currentTime === lastPosition) {
              stuckCounter++;
              if (stuckCounter > 5) { // 5回連続で同じ位置の場合
                updateStatus('再生が停止している可能性 - 復旧試行中', true);
                videoPlayer.currentTime += 0.1; // 少し進める
                stuckCounter = 0;
              }
            } else {
              stuckCounter = 0;
              lastPosition = videoPlayer.currentTime;
            }
            
            // プログレスバー更新
            updateProgressBar();
          }
        }, 2000);
      }
      
      // サブビデオの初期化（スリープ対策）
      function initSecondaryVideo() {
        // Base64エンコードされた1x1ピクセルの黒いMP4動画
        const microVideoBase64 = 'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAA3htZGF0AAACbwYF//+l3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE1NSByMjkwMSA3ZDBmZjIyIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxOCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTEgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIzLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAwZYiEAD//8m+P5OXfBeLGOfKP9JKI6NPvHJfDpLJZPrpxnsj+VAIqbmVnSbhuUAAAAwAAAwAAAwAAAwAAJeOAHQQEDQd9Y982IQAAAdBtb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAA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AMAAAADAAAADAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAABLc3R0cwAAAAAAAAMAAAABAAAAbgEAAAOzc3R6AAAAAAAAAAAAAABGAQAA6wAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAZzdGNvAAAAAAAAAAMAAAAwAAAABQAAHvZzdHN6AAAAAAAAAAAABgAAAFUAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAMAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAF1zdHRzAAAAAAAAAwAAAAEAAAAOAQAAAQAAABdzdHN6AAAAAAAAAAAAAAIAAABnAAABNXN0Y28AAAAAAAAABQAAADAAAADlAAAA5QAAAfQAAAEQdHJhawAAAFx0cmtoZAAAAAMAAAAAAAAAAAAAAAIAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAIBtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAB9kZGlmAAAAHGRyZWYAAAAAAAAAAQAAAAwAAAAAAAAAACBzdGJsAAAAuHN0c2QAAAAAAAAAAQAAAOgAAAEAAAAAASttc2cAAAAAABAATwAgADwAIAB2AGUAcgBzAGkAbwBuAD0AIgAxAC4AMAAiAD4APAAvAHQAaQBmAGYAOgB0AGkAZgBmAD4AAAAQAHAAaQBjAHQAOgBwAGkAYwB0AAAAAUBtZXRhAAAAAAAAACJoZGxyAAAAAAAAAAAAAAAAAABTbWRpcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADnN0dHMAAAAAAAAAAQAAADwAAAL8AAAAiHN0c2MAAAAAAAAAAQAAAAEAAAAQAAAAAQAAADxzdHN6AAAAAAAAAAAAAAAAPAAAAEAAAAA4AAAAOgAAAEAAAAAWAAAARQAAAEIAAAA0AAAAOQAAAEIAAAAwAAAANQAAAEUAAAAyAAAAOgAAADkAAABEAAAANwAAADcAAABCAAAANwAAAEEAAABEAAAAQAAAAEsAAAAwAAAARQAAAEUAAAA4AAAAFgAAAEIAAABLAAAANwAAADMAAABDAAAARwAAADIAAABFAAAAMAAAAEYAAABDAAAAMwAAADgAAABEAAAAOAAAAEsAAABBAAAAAdbzdHNzAAAAAAAAAAEAAAA8AAACGAAAAHBzdGNvAAAAAAAAAAQAAAF0AAABdAAAAXQAAAF0dHJhawAAAFx0cmtoZAAAAAMAAAAAAAAAAAAAAAIAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAABAAAAAAIAAAACAAIAc3R0cwAAAAAAAAA9AAABBAAAAAEAAAKIAAAABQAAAAAAAAADAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAUAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAFAAAABAAAACQAAAAEAAAA+AAAAAQAAADoAAAABAAAAPIAAAAEAAAA+AAAAAQAAADgAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAA+AAAAAQAAAD4AAAABAAAAPIAAAAEAAAAyAAAAAQAAADoAAAABAAAAPIAAAAEAAABAAAAAAQAAADwAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAA+AAAAAQAAAD4AAAABAAAAPIAAAAEAAAAyAAAAAQAAADIAAAABAAAAPIAAAAEAAABAAAAAAQAAADwAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAA+AAAAAQAAAD4AAAABAAAAPIAAAAEAAAAyAAAAAQAAADIAAAABAAAAPIAAAAEAAABAAAAAAQAAADwAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAAuAAAAAQAAACwAAAABAAAAPIAAAAEAAABAAAAAAQAAAEAAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAAuAAAAAQAAACwAAAABAAAAPIAAAAEAAABAAAAAAQAAAEAAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAAuAAAAAQAAACwAAAABAAAAPIAAAAEAAABAAAAAAQAAAEAAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAAuAAAAAQAAACwAAAABAAAAPIAAAAEAAABAAAAAAQAAAEAAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAAuAAAAAQAAACwAAAABAAAAPIAAAAEAAABAAAAAAQAAAEAAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAAuAAAAAQAAACwAAAABAAAAPIAAAAEAAABAAAAAAQAAAEAAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAAuAAAAAQAAACwAAAABAAAAPIAAAAEAAABAAAAAAQAAAEAAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAAuAAAAAQAAACwAAAABAAAAPIAAAAEAAABAAAAAAQAAADwAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAA+AAAAAQAAAD4AAAABAAAAPIAAAAEAAAAyAAAAAQAAADIAAAABAAAAPIAAAAEAAABAAAAAAQAAADwAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAA+AAAAAQAAAD4AAAABAAAAPIAAAAEAAAAyAAAAAQAAADIAAAABAAAAPIAAAAEAAABAAAAAAQAAADwAAAABAAAAPIAAAAEAAAA8gAAAAQAAADwAAAABAAAAPIAAAAEAAAA+AAAAAQAAAD4AAAABAAAAPIAAAAEAAAAyAAAAAQAAADIAAAABAAAAPIAAAAEAAAAGAAAAAQAAABoAAAABAAAAGgAAAAEA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AQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABBAAAAAEAAAEEAAAAAQAAAQQAAAABAAABFQAAAAEAAAE/AAAAAQAAAUkAAAABAAABPwAAAAEAAAD4AAAAAQAAAPwAAAABAAABPwAAAAEAAAEEAAAAAQAAARQAAAABAAABBAAAAAAAADJzdGNvAAAAAAAAAAQAAAEAAABtAAABdAAAAXQAAAF0AAA4EXN0c3oAAAAAAAAAAAAAADwAAABgAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAKxzdGNvAAAAAAAAAAQAAABkAAACsgAAAXQAAAF0AAA+IXN0dHMAAAAAAAAAAQAAACgAAAOMAAAAEHN0c3MAAAAAAAAAAwAAAAEAAAATAAAAAQAAAMxzdHN6AAAAAAAAAAAAAABHAAAAGQAAAAYAAAAKAAAABgAAAAoAAAALAAAACwAAAAsAAAALAAAADQAAAA4AAAAOAAAADgAAAA4AAAAQAAAADwAAAA8AAAAPAAAAEgAAAA4AAAAMAAAACgAAAAwAAAAMAAAACgAAAAoAAAAKAAAACwAAAAsAAAAKAAAACgAAAAwAAAAOAAAADQAAAAwAAAALAAAACwAAAAoAAAAJAAAACwAAAAsAAAAMAAAACwAAAA0AAAALAAAACgAAAAsAAAAMAAAADAAAAAoAAAAKAAAACgAAAA4AAAAOAAAADAAAAA0AAAAoAAAAPXN0dHMAAAAAAAAAAQAAACgAAAL8AAAAiHN0c2MAAAAAAAAAAQAAAAEAAAATAAAAAQAAAHZzdHN6AAAAAAAAAAAARQAAACkAAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAAD3N0Y28AAAAAAAAAAQQAT1BVUwAAAABWRVJCSVMAAABPZ2dTAAAATGF2ZjU4LjI5LjEwMAUA';
        secondaryVideo.src = microVideoBase64;
        secondaryVideo.play().catch(e => console.error('Secondary video playback failed:', e));
      }
      
      // モバイルでの通知関連のAPIをセットアップ
      function setupMobileAPIs() {
        // 通知許可の要求
        if ('Notification' in window) {
          Notification.requestPermission();
        }
        
        // PWA関連のハンドリング
        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          const deferredPrompt = e;
          updateStatus('PWAインストール可能');
        });
        
        // モバイルデバイスではスクリーン常時表示を試みる
        if (!document.documentElement.requestFullscreen) {
          try {
            document.documentElement.requestFullscreen();
          } catch (e) {
            console.log('Fullscreen request failed:', e);
          }
        }
      }
      
      // 直接ビデオURLを取得して再生
      async function loadDirectVideo() {
        try {
          updateStatus('直接ストリームを取得中...');
          
          const response = await fetch(\`/api/youtube/get-direct-urls/\${videoId}\`);
          const data = await response.json();
          
          if (data && data.formats && data.formats.length > 0) {
            // 最適な形式を選択（HD以上でサイズの小さいもの）
            let selectedFormat = null;
            
            // まずHD以上のビデオから探す
            const hdFormats = data.formats.filter(f => 
              f.qualityLabel && 
              (f.qualityLabel.includes('720p') || f.qualityLabel.includes('1080p')) &&
              f.mimeType && f.mimeType.includes('video/mp4')
            );
            
            if (hdFormats.length > 0) {
              // サイズでソート
              selectedFormat = hdFormats.sort((a, b) => (a.contentLength || 0) - (b.contentLength || 0))[0];
            } else {
              // HD形式がなければ、利用可能な最高品質のMP4を選択
              const mp4Formats = data.formats.filter(f => f.mimeType && f.mimeType.includes('video/mp4'));
              if (mp4Formats.length > 0) {
                selectedFormat = mp4Formats.sort((a, b) => (b.height || 0) - (a.height || 0))[0];
              }
            }
            
            // 選択した形式がなければ最初の形式を使用
            if (!selectedFormat && data.formats.length > 0) {
              selectedFormat = data.formats[0];
            }
            
            if (selectedFormat && selectedFormat.url) {
              videoPlayer.src = selectedFormat.url;
              videoPlayer.poster = thumbnailUrl;
              
              // 再生を開始
              updateStatus('直接再生を開始...');
              videoPlayer.play()
                .then(() => {
                  updateStatus('再生中');
                  playbackStarted = true;
                  
                  // MediaSession APIのセットアップ
                  setupMediaSession();
                  
                  // WakeLockの取得を試みる
                  acquireWakeLock();
                  
                  // サイレントオーディオを初期化
                  initSilentAudio();
                  
                  // サブビデオも初期化
                  initSecondaryVideo();
                  
                  // 再生状態の監視を開始
                  startVideoMonitoring();
                  
                  // モバイルAPI関連のセットアップ
                  setupMobileAPIs();
                  
                  // バックグラウンド対策用のCPUタスクを開始
                  startCpuTask();
                  
                  // ユーザーに定期的に振動通知を送って活動状態を維持
                  setInterval(() => {
                    navigator.vibrate && navigator.vibrate(1);
                    navigator.serviceWorker && navigator.serviceWorker.ready;
                  }, 25000);
                })
                .catch(err => {
                  handlePlaybackError(err);
                });
            } else {
              throw new Error('適切な動画形式が見つかりませんでした');
            }
          } else {
            throw new Error('利用可能な動画形式がありません');
          }
        } catch (error) {
          handlePlaybackError(error);
        }
      }
      
      // YouTubeで直接開く
      function openInYoutube() {
        window.open(\`https://www.youtube.com/watch?v=\${videoId}\`, '_blank');
      }
      
      // もう一度最初から読み込み
      function reloadPlayer() {
        window.location.reload();
      }
      
      // 代替プレーヤーで再生
      function playWithAlternatePlayer() {
        window.location.href = \`/api/youtube/proxy-player/\${videoId}?autoplay=1\`;
      }
      
      // ボタンイベント
      restartButton.addEventListener('click', reloadPlayer);
      directButton.addEventListener('click', loadDirectVideo);
      youtubeButton.addEventListener('click', openInYoutube);
      retryButton.addEventListener('click', reloadPlayer);
      altButton.addEventListener('click', playWithAlternatePlayer);
      openYoutubeButton.addEventListener('click', openInYoutube);
      
      // ビデオイベント
      videoPlayer.addEventListener('ended', () => {
        updateStatus('再生終了');
      });
      
      videoPlayer.addEventListener('error', (e) => {
        handlePlaybackError(e);
      });
      
      videoPlayer.addEventListener('stalled', () => {
        updateStatus('読み込み中断 - 復旧を試行中', true);
      });
      
      videoPlayer.addEventListener('waiting', () => {
        updateStatus('バッファリング中...');
      });
      
      videoPlayer.addEventListener('playing', () => {
        updateStatus('再生中');
        playbackStarted = true;
      });
      
      videoPlayer.addEventListener('timeupdate', () => {
        updateProgressBar();
      });
      
      videoPlayer.addEventListener('pause', () => {
        updateStatus('一時停止中');
      });
      
      // スリープ検出
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          isSleeping = true;
          updateStatus('バックグラウンド動作中');
        } else {
          isSleeping = false;
          updateStatus('フォアグラウンド復帰');
        }
      });
      
      // ページが閉じられる前の処理
      window.addEventListener('beforeunload', () => {
        // WakeLockを解放
        if (wakeLock) {
          wakeLock.release();
        }
        
        // インターバルをクリア
        if (videoCheckInterval) clearInterval(videoCheckInterval);
        if (cpuTaskInterval) clearInterval(cpuTaskInterval);
      });
      
      // ユーザーのタッチ/クリックイベント
      document.addEventListener('click', () => {
        lastActivityTime = Date.now();
      });
      
      document.addEventListener('touchstart', () => {
        lastActivityTime = Date.now();
      });
      
      // 初期化
      loadDirectVideo();
    });
  </script>
</body>
</html>`;
}